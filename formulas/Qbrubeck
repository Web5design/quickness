### Brubeck installs consist of installing ZeroMQ, Mongrel2 and some Python
### packages. This script currently covers all of this, though it'd be ideal
### to break it apart into more modular components.

###
### Settings
###

BRUBECK_PREV_DIR=$PWD
cd $QUICKNESS_SRC


###
### Formula Dependencies
###

. Qevented_libs
. Qpython_dev
. Qzeromq
. Qmongrel2

###
### VirtualEnv
###

mkvirtualenv brubeck

###
### Concurrency with Gevent
###

pip install gevent

### Gevent + ZeroMQ requires a little special handling right now
if [ -d "gevent-zeromq" ]; then
    rm -rf gevent-zeromq
fi
git clone https://github.com/traviscline/gevent-zeromq
cd gevent-zeromq
python setup.py install
cd ..


###
### Brubeck
###


if [ -d "brubeck" ]; then
    rm -rf brubeck
fi

git clone https://github.com/j2labs/brubeck.git
cd brubeck

### The next few steps leave a `build/` in the brubeck directory

### Install Brubeck's dependencies
pip install -I -r envs/brubeck.reqs


### Install Brubeck itself
python setup.py install

cd $BRUBECK_PREV_DIR
