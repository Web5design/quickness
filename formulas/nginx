###
### nginx
###
### As of the release of precise pangolin nginx is
### fairly old, if you want to just install the
### the version in the standard repo pass the ubuntu
### argument to the formula '. $Q/nginx ubuntu'
###

###
### Initialize
###

if [ "$(is_formula_installed)" = "yes" ]; then
    quickness_teardown
    return
fi

NGINX_VERSION="nginx-1.3.0"
NGINX_PREV_DIR=$PWD
cd $QUICKNESS_SRC


###
### Dependencies
###

if [ ! "$1" = "ubuntu" ]; then
    . $Q/evented_libs
    . $Q/pcre
fi


###
### Installation
###

if [ "$1" = "ubuntu" ]; then
    sudo apt-get -y install nginx
else
    if [ -d nginx ]; then
        rm -rf ./nginx
    fi
    if [ ! -f $NGINX_VERSION.tar.gz ]; then
        wget http://nginx.org/download/$NGINX_VERSION.tar.gz
    fi

    tar zxf $NGINX_VERSION.tar.gz
    cd $NGINX_VERSION
    ./configure --with-http_ssl_module
    make && sudo make install

    sudo ln -s /usr/local/nginx/sbin/nginx /usr/local/bin/
fi


###
### Teardown
###

cd $NGINX_PREV_DIR
unset NGINX_VERSION
unset NGINX_PREV_DIR

quickness_msg "
  Server: sudo nginx
   - Note: if you installed from standard repos run 'sudo service nginx start'"

quickness_teardown
