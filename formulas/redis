###
### Redis
###
### As of the release of precise pangolin redis is
### a version behind, if you want to just install the
### the version in the standard repo pass the ubuntu
### argument to the formula '. $Q/redis ubuntu'
###

###
### Initialize
###

if [ "$(is_formula_installed)" = "yes" ]; then
    quickness_teardown
    return
fi

REDIS_VERSION="redis-2.4.14"
REDIS_PREV_DIR=$PWD
cd $QUICKNESS_SRC


###
### Installation
###

if [ "$1" = "ubuntu" ]; then
    sudo apt-get -y install redis-server
else
    sudo apt-get -y install tcl8.5

    if [ -d $REDIS_VERSION ]; then
        rm -rf $REDIS_VERSION
    fi
    if [ ! -f $REDIS_VERSION.tar.gz ]; then
        wget http://redis.googlecode.com/files/$REDIS_VERSION.tar.gz
    fi

    tar zxf $REDIS_VERSION.tar.gz
    cd $REDIS_VERSION
    make && sudo make install
fi


###
### Teardown
###

cd $REDIS_PREV_DIR
unset REDIS_VERSION
unset REDIS_PREV_DIR

quickness_msg "
  Server: redis-server
   - Optionally: redis-server /path/to/redis.conf
   - Note: If you installed from standard repo's redis should already be running
  Client: redis-cli

  Worth reading:
   - http://redis.io/commands/auth"

quickness_teardown
